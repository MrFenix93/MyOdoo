<odoo>
  <data>

    <!-- LIST -->
    <record id="view_cash_in_list" model="ir.ui.view">
      <field name="name">cash.treasury.in.list</field>
      <field name="model">cash.treasury.in</field>
      <field name="arch" type="xml">
        <list import="false">
          <field name="name"/>
          <field name="journal_id"/>
          <field name="destination_account_id"/>
          <field name="partner_id"/>
          <field name="amount"/>
          <field name="collection_date"/>
          <field name="state"/>
        </list>
      </field>
    </record>

    <!-- SEARCH -->
    <record id="view_cash_in_search" model="ir.ui.view">
      <field name="name">cash.treasury.in.search</field>
      <field name="model">cash.treasury.in</field>
      <field name="arch" type="xml">
        <search>
          <filter name="filter_draft" string="Draft" domain="[('state','=','draft')]"/>
          <filter name="filter_approved" string="Approved" domain="[('state','=','approved')]"/>
          <filter name="filter_posted" string="Posted" domain="[('state','=','posted')]"/>

          <group expand="0" string="Group By">
            <filter name="group_state" string="State" context="{'group_by':'state'}"/>
            <filter name="group_journal" string="Journal" context="{'group_by':'journal_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <!-- FORM -->
    <record id="view_cash_in_form" model="ir.ui.view">
      <field name="name">cash.treasury.in.form</field>
      <field name="model">cash.treasury.in</field>
      <field name="arch" type="xml">
        <form>

          <header>
		
            <!-- Accountant approves -->
            <button name="action_approve"
                    type="object"
                    string="Approve"
                    class="btn-primary"
                    groups="cash_treasury.group_cash_in_accountant"
                    invisible="state != 'draft'"/>

            <!-- Accountant can reset before posting -->
            <button name="action_back_to_draft"
                    type="object"
                    string="Reset to Draft"
                    class="btn-secondary"
                    groups="cash_treasury.group_cash_in_accountant"
                    invisible="state != 'approved'"/>

            <!-- Entry posts -->
            <button name="action_post"
                    type="object"
                    string="Post"
                    class="btn-primary"
                    groups="cash_treasury.group_cash_in_entry"
                    invisible="state != 'approved'"/>

            <!-- Shared Super -->
            <button name="action_super_cancel_posted_to_draft"
                    type="object"
                    string="Cancel Posted ? Draft (Super)"
                    class="btn-danger"
                    groups="cash_treasury.group_cash_super_approver"
                    invisible="state != 'posted'"/>

            <field name="state" widget="statusbar"/>

          </header>

          <sheet>

            <h1>
              <field name="name"
                     placeholder="Draft"
                     modifiers="{'readonly': [['state','!=','draft']]}"/>
            </h1>

            <group col="2">
              <group>

                <field name="receive_from_type"
                       widget="radio"
			required="1"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="account_id"
                       invisible="receive_from_type != 'account'"
                        required="receive_from_type == 'account'"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="partner_id"
                       invisible="receive_from_type != 'partner'"
		       required="receive_from_type == 'partner'"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="amount"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="date"
                       string="Document Date"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="notes"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="invoices_loaded" invisible="1"/>

              </group>

              <group>

                <field name="journal_id"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <field name="payment_method_id"
                       modifiers="{'readonly': [['state','!=','draft']]}"/>

                <!-- Collection Date: editable only for Cash In Entry in Approved -->
                <field name="collection_date"
                       groups="cash_treasury.group_cash_in_entry"
                       invisible="state not in ('approved','posted')"
                       modifiers="{'readonly': [['state','!=','approved']]}"/>

                <!-- Collection Date readonly for others -->
                <field name="collection_date"
                       groups="cash_treasury.group_cash_in_accountant,cash_treasury.group_cash_super_approver"
                       invisible="state not in ('approved','posted')"
                       readonly="1"/>

                <field name="journal_entry_id"
                       readonly="1"
                       invisible="journal_entry_id == False"/>

                <field name="reversal_entry_id"
                       readonly="1"
                       invisible="reversal_entry_id == False"/>

              </group>
            </group>

            <!-- LOAD CUSTOMER INVOICES BUTTON -->
            <button name="action_load_customer_invoices"
                    type="object"
                    string="Load Customer Invoices"
                    class="btn-secondary"
                    invisible="receive_from_type != 'partner'
                               or state != 'draft'
                               or partner_id == False"/>

            <!-- ALLOCATION -->
            <group string="Customer Invoices Allocation"
                   invisible="receive_from_type != 'partner' or invoices_loaded == False">

              <separator string=""/>

              <field name="allocation_line_ids"
                     nolabel="1"
                     create="0"
                     delete="0"
                     options="{'no_open': True}"
                     modifiers="{'readonly': [['state','!=','draft']]}">

                <list editable="bottom" create="0" delete="0">
                  <field name="selected" widget="boolean_toggle"/>
                  <field name="invoice_id" readonly="1" options="{'no_open': True}"/>
                  <field name="name" readonly="1"/>
                  <field name="residual_amount" readonly="1"/>
                  <field name="amount_to_collect"
                         modifiers="{'readonly': [['selected','=',false]]}"/>
                </list>
              </field>

              <group col="4">
                <field name="total_allocated" readonly="1"/>
                <field name="allocation_diff" readonly="1"/>
              </group>

            </group>

          </sheet>

          <chatter/>

        </form>
      </field>
    </record>

  </data>
</odoo>
